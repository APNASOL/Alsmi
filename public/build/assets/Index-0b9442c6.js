import k from"./Master-5da9f18f.js";import{s as y}from"./multiselect-2dd2a9a9.js";import"./vue-datepicker-8b154446.js";import"./main-ae0ebc8a.js";import{_ as U,a as c,r as p,o as a,c as i,b as s,t as r,e as _,F as E,h as x,k as M,w as u,v as f,n as m,g as d,f as V,u as h,i as I}from"./app-781ff030.js";import"./defineProperty-4d844dfb.js";const S={layout:k,created(){this.fetchUsers()},components:{Multiselect:y},data(){return{Users:[],deleteId:null,downloadBtnStatus:1,Users_ids:"",form:{user_id:"",user_name:"",email:"",role:"",password:"",confirm_password:""},RoleOptions:["super admin","admin","accountant"],formErrors:[],formStatus:1}},methods:{fetchUsers(){c.get(route("api.users.fetch"),{headers:{Authorization:"Bearer "+this.$page.props.auth_token}}).then(l=>{this.Users=l.data.users,this.Users_ids=l.data.users_ids}).catch(l=>{toastr.error(l.response.data.message)})},deleteThis(l){c.delete(route("api.users.delete",l),{headers:{Authorization:"Bearer "+this.$page.props.auth_token}}).then(()=>{toastr.success("User deleted successfully."),this.fetchUsers()}).catch(e=>{toastr.error(e.response.data.message)})},submit(){this.formStatus=0,c.post(route("api.users.store"),this.form,{headers:{Authorization:"Bearer "+this.$page.props.auth_token}}).then(()=>{this.form.user_id?toastr.success("User record updated."):toastr.success("New user created."),this.$refs.closeModal.click(),this.fetchUsers(),this.formStatus=1}).catch(l=>{this.formStatus=1,toastr.error(l.response.data.message),l.response.data.errors&&(this.formErrors=l.response.data.errors)})},clearFields(){this.form.user_id="",this.form.user_name="",this.form.email="",this.form.role="",this.form.password="",this.form.confirm_password="",this.formErrors=[]},showUser(l){c.get(route("api.users.show",l),{headers:{Authorization:"Bearer "+this.$page.props.auth_token}}).then(e=>{this.form.user_id=e.data.id,this.form.user_name=e.data.name,this.form.email=e.data.email,this.form.role=e.data.role}).catch(e=>{toastr.error(e.response.data.message)})},restrictAdmin(l,e){return!(l=="super admin"&&e=="admin")}}},B={id:"main",class:"main"},C={class:"pagetitle d-flex justify-content-between"},A={class:"section"},D={class:"card"},F={class:"card-body pt-4"},N={class:"table-responsive"},T={class:"table table-striped"},z={class:"text-center"},L={class:"text-center"},R={class:"btn-group"},O={class:"modal fade",id:"usermodal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},j={class:"modal-dialog modal-lg"},q={class:"modal-content"},G={class:"modal-body"},H={class:"card card-body p-3"},J={class:"row g-3"},K={class:"col-12 col-md-6"},P={key:0,class:"invalid-feedback animated fadeIn"},Q={class:"col-12 col-md-6"},W={key:0,class:"invalid-feedback animated fadeIn"},X={class:"col-12 col-md-12"},Y={key:0,class:"invalid-feedback animated fadeIn"},Z={key:0,class:"row g-3"},$={class:"col-12 col-md-6"},ss={key:0,class:"invalid-feedback animated fadeIn"},es={class:"col-12 col-md-6"},os={key:0,class:"invalid-feedback animated fadeIn"},ts={class:"mt-5"},rs={key:0,type:"submit",class:"btn btn-success"},ls={key:1,class:"btn btn-success",type:"button",disabled:""},as={hidden:"hidden","data-bs-toggle":"modal","data-bs-target":"#usermodal",title:"Delete",ref:"closeModal"};function is(l,e,ds,ns,o,n){const b=p("Link"),v=p("DeleteModal"),g=p("Multiselect");return a(),i("main",B,[s("div",C,[e[8]||(e[8]=s("div",null,[s("h1",null,r("User")),s("nav",null,[s("ol",{class:"breadcrumb"},[s("li",{class:"breadcrumb-item"},[s("a",{href:"/dashboard"},"Alsmi")]),s("li",{class:"breadcrumb-item active"},"Users")])])],-1)),s("div",null,[s("button",{class:"btn btn-success mt-3","data-bs-toggle":"modal","data-bs-target":"#usermodal",onClick:e[0]||(e[0]=(...t)=>n.clearFields&&n.clearFields(...t))},e[7]||(e[7]=[s("i",{class:"bi bi-plus-lg"},null,-1),_(" Add New User ")]))])]),s("section",A,[s("div",D,[s("div",F,[s("div",N,[s("table",T,[e[10]||(e[10]=s("thead",null,[s("tr",null,[s("th",{scope:"col",class:"text-center"},"#"),s("th",{scope:"col"},r("User name")),s("th",{scope:"col"},r("User email")),s("th",{scope:"col"},r("User Role")),s("th",{scope:"col",class:"text-center"},r("Actions"))])],-1)),s("tbody",null,[(a(!0),i(E,null,x(o.Users,(t,w)=>(a(),i("tr",{key:t.id},[s("th",z,r(w+1),1),s("td",null,r(t.first_name)+" "+r(t.last_name),1),s("td",null,r(t.email),1),s("td",null,r(t.role),1),s("td",L,[s("div",R,[l.$page.props.user.role=="admin"&&t.role!="admin"?(a(),h(b,{key:0,type:"button",class:"btn btn-sm fs-6",title:"Edit","data-bs-toggle":"modal","data-bs-target":"#usermodal",onClick:ms=>(n.showUser(t.id),n.clearFields())},{default:I(()=>e[9]||(e[9]=[s("i",{class:"bi bi-pencil"},null,-1)])),_:2},1032,["onClick"])):d("",!0),l.$page.props.user.role=="admin"&&t.role!="admin"?(a(),h(v,{key:1,deleteId:t.id,onDeleteThis:n.deleteThis},null,8,["deleteId","onDeleteThis"])):d("",!0)])])]))),128))])])])])])]),s("div",O,[s("div",j,[s("div",q,[e[17]||(e[17]=s("div",{class:"modal-header"},[s("div",{class:"section-title mt-1"},[s("h5",{class:"c-theme-red"},"User form")]),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),s("div",G,[s("div",H,[s("form",{onSubmit:e[6]||(e[6]=M((...t)=>n.submit&&n.submit(...t),["prevent"]))},[s("div",J,[s("div",K,[e[11]||(e[11]=s("label",{for:"user_name"},r("User name"),-1)),u(s("input",{type:"text",class:m(["form-control",{"invalid-bg":o.formErrors.user_name}]),id:"user_name","onUpdate:modelValue":e[1]||(e[1]=t=>o.form.user_name=t)},null,2),[[f,o.form.user_name]]),o.formErrors.user_name?(a(),i("div",P,r(o.formErrors.user_name[0]),1)):d("",!0)]),s("div",Q,[e[12]||(e[12]=s("label",{for:"email"},r("User email"),-1)),u(s("input",{type:"email",class:m(["form-control",{"invalid-bg":o.formErrors.email}]),id:"email","onUpdate:modelValue":e[2]||(e[2]=t=>o.form.email=t)},null,2),[[f,o.form.email]]),o.formErrors.email?(a(),i("div",W,r(o.formErrors.email[0]),1)):d("",!0)]),s("div",X,[e[13]||(e[13]=s("label",null,r("Role"),-1)),V(g,{id:"",modelValue:o.form.role,"onUpdate:modelValue":e[3]||(e[3]=t=>o.form.role=t),options:o.RoleOptions,searchable:!0,class:m({"invalid-bg":o.formErrors.role})},null,8,["modelValue","options","class"]),o.formErrors.role?(a(),i("div",Y,r(o.formErrors.role[0]),1)):d("",!0)]),o.form.user_id?d("",!0):(a(),i("div",Z,[s("div",$,[e[14]||(e[14]=s("label",{for:"password"},r("User password"),-1)),u(s("input",{type:"password",class:m(["form-control",{"invalid-bg":o.formErrors.password}]),id:"password","onUpdate:modelValue":e[4]||(e[4]=t=>o.form.password=t)},null,2),[[f,o.form.password]]),o.formErrors.password?(a(),i("div",ss,r(o.formErrors.password[0]),1)):d("",!0)]),s("div",es,[e[15]||(e[15]=s("label",{for:"confirm_password"},r("Confirm password"),-1)),u(s("input",{type:"password",class:m(["form-control",{"invalid-bg":o.formErrors.confirm_password}]),id:"confirm_password","onUpdate:modelValue":e[5]||(e[5]=t=>o.form.confirm_password=t)},null,2),[[f,o.form.confirm_password]]),o.formErrors.confirm_password?(a(),i("div",os,r(o.formErrors.confirm_password[0]),1)):d("",!0)])]))]),s("div",ts,[o.formStatus==1?(a(),i("button",rs,r("Save"))):(a(),i("button",ls,e[16]||(e[16]=[_(r("Save")+" "),s("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)])))])],32)])])])]),s("button",as,null,512)])])}const bs=U(S,[["render",is]]);export{bs as default};
