import{_,a as m,r as v,o,c as r,d as y,b as s,g as d,f as u,w as f,v as b,t as p,n as g}from"./app-781ff030.js";import D from"./Master-5da9f18f.js";import{s as F}from"./multiselect-2dd2a9a9.js";import"./jspdf.plugin.autotable-6c2269d8.js";import{Z as E}from"./vue-datepicker-8b154446.js";import"./main-ae0ebc8a.js";import"./defineProperty-4d844dfb.js";const x={layout:D,components:{Multiselect:F,Datepicker:E},data(){return{filteredEntries:[],selectedFilter:"Monthly",selectedMonth:1,selectedYear:new Date().getFullYear(),startDate:"",endDate:"",monthsOptions:[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],yearsOptions:Array.from({length:2050-2025+1},(a,e)=>2025+e),transactionEntries:[],totalIncome:0,totalExpense:0,totalProfit:0,FilterErrors:"",serachingLoading:!1,pdfBtnLoader:!1,excelBtnLoader:!1}},mounted(){this.fetchTransactionEntries()},methods:{fetchTransactionEntries(){if(this.serachingLoading=!0,this.FilterErrors="",this.selectedFilter==="Monthly"&&(!this.selectedMonth||!this.selectedYear)){this.FilterErrors="Please select both Month and Year for the Monthly filter.",this.serachingLoading=!1;return}if(this.selectedFilter==="Yearly"&&!this.selectedYear){this.FilterErrors="Please select a Year for the Yearly filter.",this.serachingLoading=!1;return}if(this.selectedFilter==="Custom"&&(!this.startDate||!this.endDate)){this.FilterErrors="Please select both Start Date and End Date for the Custom filter.",this.serachingLoading=!1;return}let a=new FormData;a.append("selectedFilter",this.selectedFilter),this.selectedMonth&&a.append("selectedMonth",this.selectedMonth),this.selectedYear&&a.append("selectedYear",this.selectedYear),this.startDate&&a.append("startDate",this.startDate),this.endDate&&a.append("endDate",this.endDate),m.post(route("api.transaction.income.statements.fetch"),a,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.serachingLoading=!1,console.log(e.data),this.transactionEntries=e.data.transactionEntries||[],this.totalIncome=e.data.totalIncome||0,this.totalExpense=e.data.totalExpense||0,this.totalProfit=e.data.totalProfit||0}).catch(e=>{this.serachingLoading=!1,console.error(e)})},applyFilter(){let a=[...this.transactionEntries];this.selectedFilter==="Monthly"?a=a.filter(e=>new Date(e.transaction_date).getMonth()+1===this.selectedMonth&&new Date(e.transaction_date).getFullYear()===this.selectedYear):this.selectedFilter==="Yearly"?a=a.filter(e=>new Date(e.transaction_date).getFullYear()===this.selectedYear):this.selectedFilter==="Custom"&&(a=a.filter(e=>new Date(e.transaction_date)>=new Date(this.startDate)&&new Date(e.transaction_date)<=new Date(this.endDate))),this.filteredEntries=a,this.calculateSummary()},calculateSummary(){this.totalIncome=this.filteredEntries.reduce((a,e)=>a+parseFloat(e.cash_in||0),0),this.totalExpense=this.filteredEntries.reduce((a,e)=>a+parseFloat(e.cash_out||0),0),this.totalProfit=this.totalIncome-this.totalExpense},formatCurrency(a){return new Intl.NumberFormat("en-PK",{minimumFractionDigits:0,maximumFractionDigits:0}).format(a)},exportToPDF(){this.pdfBtnLoader=!0;let a=new FormData;a.append("selectedFilter",this.selectedFilter),this.selectedMonth&&a.append("selectedMonth",this.selectedMonth),this.selectedYear&&a.append("selectedYear",this.selectedYear),this.startDate&&a.append("startDate",this.startDate),this.endDate&&a.append("endDate",this.endDate),m.post(route("download-income-statement-pdf"),a,{headers:{"Content-Type":"multipart/form-data"},responseType:"blob"}).then(e=>{const i=document.createElement("a"),c=window.URL.createObjectURL(new Blob([e.data]));i.href=c,i.setAttribute("download","TransactionReport.pdf"),document.body.appendChild(i),i.click(),document.body.removeChild(i),this.pdfBtnLoader=!1}).catch(e=>{var i,c;this.pdfBtnLoader=!1,toastr.error(((c=(i=e.response)==null?void 0:i.data)==null?void 0:c.message)||"Error generating PDF")})}}},M={id:"main",class:"main"},Y={class:"section"},C={class:"card"},w={class:"card-body"},L={class:"d-flex justify-content-end p-2"},k={key:0,class:"btn-group",role:"group"},V=["disabled"],P={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},T={key:1},I={class:"card card-body p-2"},S={class:"row"},B={class:"d-flex justify-content-between align-items-center c-filter"},U={class:"d-flex align-items-center gap-2"},N={class:"col-auto"},O={key:0,class:"col-auto d-flex gap-2"},A={class:"col-auto"},j={class:"col-auto"},J={key:1,class:"col-auto"},R={key:2,class:"col-auto d-flex gap-2"},Z={class:"col-auto"},z=["disabled"],K={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},q={key:1},G={key:0,class:"text-danger"},H={key:0},Q={class:"table table-bordered"},W={colspan:"1",class:"text-success"},X={colspan:"1",class:"text-danger"},$={key:1};function ee(a,e,i,c,t,n){const h=v("Multiselect");return o(),r("main",M,[e[15]||(e[15]=y('<div class="pagetitle d-flex justify-content-between" data-v-622b6a30><div data-v-622b6a30><h1 class="theme-text-color" data-v-622b6a30>Income Statement</h1><nav data-v-622b6a30><ol class="breadcrumb" data-v-622b6a30><li class="breadcrumb-item" data-v-622b6a30><a href="/dashboard" data-v-622b6a30>Alsmi</a></li><li class="breadcrumb-item" data-v-622b6a30>Income Statement</li><li class="breadcrumb-item active" data-v-622b6a30>Index</li></ol></nav></div></div>',1)),s("section",Y,[s("div",C,[s("div",w,[e[14]||(e[14]=s("h5",{class:"card-title theme-text-color"}," Income Statement ",-1)),s("div",L,[t.transactionEntries&&t.transactionEntries.length?(o(),r("div",k,[s("button",{class:"btn btn-danger",title:"Download as PDF",onClick:e[0]||(e[0]=(...l)=>n.exportToPDF&&n.exportToPDF(...l)),disabled:t.pdfBtnLoader},[t.pdfBtnLoader?(o(),r("span",P)):d("",!0),t.pdfBtnLoader?d("",!0):(o(),r("span",T,e[8]||(e[8]=[s("i",{class:"bi bi-file-earmark-pdf"},null,-1)])))],8,V)])):d("",!0)]),s("div",I,[s("div",S,[s("div",B,[s("div",U,[s("div",N,[u(h,{modelValue:t.selectedFilter,"onUpdate:modelValue":e[1]||(e[1]=l=>t.selectedFilter=l),options:["Monthly","Yearly","Custom"],searchable:!0,placeholder:"Filter By"},null,8,["modelValue"])]),t.selectedFilter==="Monthly"?(o(),r("div",O,[s("div",A,[u(h,{modelValue:t.selectedYear,"onUpdate:modelValue":e[2]||(e[2]=l=>t.selectedYear=l),options:t.yearsOptions,searchable:!0,onClear:n.fetchTransactionEntries,placeholder:"Select Year"},null,8,["modelValue","options","onClear"])]),s("div",j,[u(h,{modelValue:t.selectedMonth,"onUpdate:modelValue":e[3]||(e[3]=l=>t.selectedMonth=l),options:t.monthsOptions,searchable:!0,onClear:n.fetchTransactionEntries,placeholder:"Select Month"},null,8,["modelValue","options","onClear"])])])):d("",!0),t.selectedFilter==="Yearly"?(o(),r("div",J,[u(h,{modelValue:t.selectedYear,"onUpdate:modelValue":e[4]||(e[4]=l=>t.selectedYear=l),options:t.yearsOptions,searchable:!0,onClear:n.fetchTransactionEntries,placeholder:"Select Year"},null,8,["modelValue","options","onClear"])])):d("",!0),t.selectedFilter==="Custom"?(o(),r("div",R,[f(s("input",{type:"date",class:"form-control",id:"date","onUpdate:modelValue":e[5]||(e[5]=l=>t.startDate=l),placeholder:"Start Date"},null,512),[[b,t.startDate]]),f(s("input",{type:"date",class:"form-control",id:"date","onUpdate:modelValue":e[6]||(e[6]=l=>t.endDate=l),placeholder:"End Date"},null,512),[[b,t.endDate]])])):d("",!0),s("div",Z,[s("button",{onClick:e[7]||(e[7]=(...l)=>n.fetchTransactionEntries&&n.fetchTransactionEntries(...l)),class:"btn btn-success",disabled:t.serachingLoading},[t.serachingLoading?(o(),r("span",K)):d("",!0),t.serachingLoading?d("",!0):(o(),r("span",q,"Search"))],8,z)])])])]),t.FilterErrors?(o(),r("span",G,p(t.FilterErrors),1)):d("",!0)]),t.transactionEntries.length?(o(),r("div",H,[s("table",Q,[s("thead",null,[e[12]||(e[12]=s("tr",null,[s("th",{colspan:"2"},"Title"),s("th",{colspan:"1"},"Amount")],-1)),s("tr",null,[e[9]||(e[9]=s("th",{colspan:"2"},"Income",-1)),s("td",W,p(n.formatCurrency(t.totalIncome)),1)]),s("tr",null,[e[10]||(e[10]=s("th",{colspan:"2"},"Expense",-1)),s("td",X,p(n.formatCurrency(t.totalExpense)),1)]),s("tr",null,[e[11]||(e[11]=s("th",{colspan:"2"},"Profit",-1)),s("th",{colspan:"1",class:g(t.totalProfit>=0?"text-success":"text-danger")},p(n.formatCurrency(t.totalProfit)),3)])])])])):(o(),r("div",$,e[13]||(e[13]=[s("p",{class:"text-center text-danger"}," No data available. ",-1)])))])])])])}const ie=_(x,[["render",ee],["__scopeId","data-v-622b6a30"]]);export{ie as default};
