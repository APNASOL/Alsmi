import{_ as v,a as m,r as _,o,c as r,d as D,b as t,f as u,g as d,w as f,v as b,t as p,n as y}from"./app-ffd8b3a9.js";import g from"./Master-cad82771.js";import{s as F}from"./multiselect-258fc9cc.js";import"./jspdf.plugin.autotable-48597783.js";import{Z as x}from"./vue-datepicker-e763a77b.js";import"./main-ae0ebc8a.js";import"./defineProperty-4d844dfb.js";const E={layout:g,components:{Multiselect:F,Datepicker:x},data(){return{filteredEntries:[],selectedFilter:"Monthly",selectedMonth:1,selectedYear:new Date().getFullYear(),startDate:"",endDate:"",monthsOptions:[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],yearsOptions:[2020,2021,2022,2023,2024,2025],transactionEntries:[],totalIncome:0,totalExpense:0,totalProfit:0,FilterErrors:"",serachingLoading:!1,pdfBtnLoader:!1,excelBtnLoader:!1}},mounted(){this.fetchTransactionEntries()},methods:{fetchTransactionEntries(){if(this.serachingLoading=!0,this.FilterErrors="",this.selectedFilter==="Monthly"&&(!this.selectedMonth||!this.selectedYear)){this.FilterErrors="Please select both Month and Year for the Monthly filter.",this.serachingLoading=!1;return}if(this.selectedFilter==="Yearly"&&!this.selectedYear){this.FilterErrors="Please select a Year for the Yearly filter.",this.serachingLoading=!1;return}if(this.selectedFilter==="Custom"&&(!this.startDate||!this.endDate)){this.FilterErrors="Please select both Start Date and End Date for the Custom filter.",this.serachingLoading=!1;return}let a=new FormData;a.append("selectedFilter",this.selectedFilter),this.selectedMonth&&a.append("selectedMonth",this.selectedMonth),this.selectedYear&&a.append("selectedYear",this.selectedYear),this.startDate&&a.append("startDate",this.startDate),this.endDate&&a.append("endDate",this.endDate),m.post(route("api.transaction.income.statements.fetch"),a,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{this.serachingLoading=!1,console.log(e.data),this.transactionEntries=e.data.transactionEntries||[],this.totalIncome=e.data.totalIncome||0,this.totalExpense=e.data.totalExpense||0,this.totalProfit=e.data.totalProfit||0}).catch(e=>{this.serachingLoading=!1,console.error(e)})},applyFilter(){let a=[...this.transactionEntries];this.selectedFilter==="Monthly"?a=a.filter(e=>new Date(e.transaction_date).getMonth()+1===this.selectedMonth&&new Date(e.transaction_date).getFullYear()===this.selectedYear):this.selectedFilter==="Yearly"?a=a.filter(e=>new Date(e.transaction_date).getFullYear()===this.selectedYear):this.selectedFilter==="Custom"&&(a=a.filter(e=>new Date(e.transaction_date)>=new Date(this.startDate)&&new Date(e.transaction_date)<=new Date(this.endDate))),this.filteredEntries=a,this.calculateSummary()},calculateSummary(){this.totalIncome=this.filteredEntries.reduce((a,e)=>a+parseFloat(e.cash_in||0),0),this.totalExpense=this.filteredEntries.reduce((a,e)=>a+parseFloat(e.cash_out||0),0),this.totalProfit=this.totalIncome-this.totalExpense},formatCurrency(a){return new Intl.NumberFormat("en-PK",{minimumFractionDigits:0,maximumFractionDigits:0}).format(a)},exportToPDF(){this.pdfBtnLoader=!0;let a=new FormData;a.append("selectedFilter",this.selectedFilter),this.selectedMonth&&a.append("selectedMonth",this.selectedMonth),this.selectedYear&&a.append("selectedYear",this.selectedYear),this.startDate&&a.append("startDate",this.startDate),this.endDate&&a.append("endDate",this.endDate),m.post(route("download-income-statement-pdf"),a,{headers:{"Content-Type":"multipart/form-data"},responseType:"blob"}).then(e=>{const i=document.createElement("a"),c=window.URL.createObjectURL(new Blob([e.data]));i.href=c,i.setAttribute("download","TransactionReport.pdf"),document.body.appendChild(i),i.click(),document.body.removeChild(i),this.pdfBtnLoader=!1}).catch(e=>{var i,c;this.pdfBtnLoader=!1,toastr.error(((c=(i=e.response)==null?void 0:i.data)==null?void 0:c.message)||"Error generating PDF")})}}},M={id:"main",class:"main"},Y={class:"section"},C={class:"card"},w={class:"card-body"},L={class:"card card-body p-2"},k={class:"d-flex justify-content-between align-items-center c-filter"},V={class:"d-flex align-items-center gap-2"},P={class:"col-auto"},T={key:0,class:"col-auto d-flex gap-2"},I={class:"col-auto"},S={class:"col-auto"},B={key:1,class:"col-auto"},U={key:2,class:"col-auto d-flex gap-2"},N={class:"col-auto"},O=["disabled"],A={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},j={key:1},J={class:"btn-group",role:"group"},R=["disabled"],Z={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},z={key:1},K={key:0,class:"text-danger"},q={key:0},G={class:"table table-bordered"},H={colspan:"1",class:"text-success"},Q={colspan:"1",class:"text-danger"},W={key:1};function X(a,e,i,c,s,n){const h=_("Multiselect");return o(),r("main",M,[e[15]||(e[15]=D('<div class="pagetitle d-flex justify-content-between" data-v-4d45832d><div data-v-4d45832d><h1 class="theme-text-color" data-v-4d45832d>Income Statement</h1><nav data-v-4d45832d><ol class="breadcrumb" data-v-4d45832d><li class="breadcrumb-item" data-v-4d45832d><a href="/dashboard" data-v-4d45832d>Alsmi</a></li><li class="breadcrumb-item" data-v-4d45832d>Income Statement</li><li class="breadcrumb-item active" data-v-4d45832d>Index</li></ol></nav></div></div>',1)),t("section",Y,[t("div",C,[t("div",w,[e[14]||(e[14]=t("h5",{class:"card-title theme-text-color"}," Income Statement ",-1)),t("div",L,[t("div",k,[t("div",V,[t("div",P,[u(h,{modelValue:s.selectedFilter,"onUpdate:modelValue":e[0]||(e[0]=l=>s.selectedFilter=l),options:["Monthly","Yearly","Custom"],searchable:!0,placeholder:"Filter By"},null,8,["modelValue"])]),s.selectedFilter==="Monthly"?(o(),r("div",T,[t("div",I,[u(h,{modelValue:s.selectedYear,"onUpdate:modelValue":e[1]||(e[1]=l=>s.selectedYear=l),options:s.yearsOptions,searchable:!0,onClear:n.fetchTransactionEntries,placeholder:"Select Year"},null,8,["modelValue","options","onClear"])]),t("div",S,[u(h,{modelValue:s.selectedMonth,"onUpdate:modelValue":e[2]||(e[2]=l=>s.selectedMonth=l),options:s.monthsOptions,searchable:!0,onClear:n.fetchTransactionEntries,placeholder:"Select Month"},null,8,["modelValue","options","onClear"])])])):d("",!0),s.selectedFilter==="Yearly"?(o(),r("div",B,[u(h,{modelValue:s.selectedYear,"onUpdate:modelValue":e[3]||(e[3]=l=>s.selectedYear=l),options:s.yearsOptions,searchable:!0,onClear:n.fetchTransactionEntries,placeholder:"Select Year"},null,8,["modelValue","options","onClear"])])):d("",!0),s.selectedFilter==="Custom"?(o(),r("div",U,[f(t("input",{type:"date",class:"form-control",id:"date","onUpdate:modelValue":e[4]||(e[4]=l=>s.startDate=l),placeholder:"Start Date"},null,512),[[b,s.startDate]]),f(t("input",{type:"date",class:"form-control",id:"date","onUpdate:modelValue":e[5]||(e[5]=l=>s.endDate=l),placeholder:"End Date"},null,512),[[b,s.endDate]])])):d("",!0),t("div",N,[t("button",{onClick:e[6]||(e[6]=(...l)=>n.fetchTransactionEntries&&n.fetchTransactionEntries(...l)),class:"btn btn-success",disabled:s.serachingLoading},[s.serachingLoading?(o(),r("span",A)):d("",!0),s.serachingLoading?d("",!0):(o(),r("span",j,"Search"))],8,O)])]),t("div",J,[t("button",{class:"btn btn-danger",title:"Download as PDF",onClick:e[7]||(e[7]=(...l)=>n.exportToPDF&&n.exportToPDF(...l)),disabled:s.pdfBtnLoader},[s.pdfBtnLoader?(o(),r("span",Z)):d("",!0),s.pdfBtnLoader?d("",!0):(o(),r("span",z,e[8]||(e[8]=[t("i",{class:"bi bi-file-earmark-pdf"},null,-1)])))],8,R)])]),s.FilterErrors?(o(),r("span",K,p(s.FilterErrors),1)):d("",!0)]),s.transactionEntries.length?(o(),r("div",q,[t("table",G,[t("thead",null,[e[12]||(e[12]=t("tr",null,[t("th",{colspan:"2"},"Title"),t("th",{colspan:"1"},"Amount")],-1)),t("tr",null,[e[9]||(e[9]=t("th",{colspan:"2"},"Income",-1)),t("td",H,p(n.formatCurrency(s.totalIncome)),1)]),t("tr",null,[e[10]||(e[10]=t("th",{colspan:"2"},"Expense",-1)),t("td",Q,p(n.formatCurrency(s.totalExpense)),1)]),t("tr",null,[e[11]||(e[11]=t("th",{colspan:"2"},"Profit",-1)),t("th",{colspan:"1",class:y(s.totalProfit>=0?"text-success":"text-danger")},p(n.formatCurrency(s.totalProfit)),3)])])])])):(o(),r("div",W,e[13]||(e[13]=[t("p",{class:"text-center text-danger"}," No data available. ",-1)])))])])])])}const re=v(E,[["render",X],["__scopeId","data-v-4d45832d"]]);export{re as default};
