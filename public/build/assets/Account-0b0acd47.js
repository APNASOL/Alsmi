import D from"./Master-cad82771.js";import{_ as E,a as v,r as g,o as n,c as a,b as s,d as V,e as b,f as u,n as c,t as i,g as d,F as C,h as S,w as h,v as _}from"./app-ffd8b3a9.js";import{s as T}from"./multiselect-258fc9cc.js";import{Z as A}from"./vue-datepicker-e763a77b.js";import"./main-ae0ebc8a.js";import{E as N}from"./jspdf.plugin.autotable-48597783.js";import"./defineProperty-4d844dfb.js";const O={layout:D,props:["customerId"],components:{Multiselect:T,Datepicker:A},created(){this.fetchDetails(),this.fetchBanks(),this.fetchConsumersList(this.form.consumer)},data(){const r=new Date().getFullYear();return{form:{id:"",process_for:"",consumer:"Customer",consumer_id:"",bank_id:"",transaction_type:"",amount:"",ref_no:"",account:"",current_amount:"",date:""},consumerOptions:["Customer","Supplier","Partner"],transaction_typeOptions:["Online","Cash"],banksOptions:[],consumerList:[],isLoading:!1,Accounts:[],filters:{month:"",year:"",fromDate:"",toDate:""},filterType:"monthYear",filterOptions:[{value:"monthYear",label:"Month and Year"},{value:"yearOnly",label:"Year Only"},{value:"dateRange",label:"Date Range"}],months:[{value:"01",label:"January"},{value:"02",label:"February"},{value:"03",label:"March"},{value:"04",label:"April"},{value:"05",label:"May"},{value:"06",label:"June"},{value:"07",label:"July"},{value:"08",label:"August"},{value:"09",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}],years:Array.from({length:10},(e,m)=>r-m),formErrors:{},pdfBtnSpinner:!1,formStatus:!0}},methods:{processFor(r){this.form.process_for=r},fetchConsumersList(r){v.get(route("api.fetch.consumers",{consumer_type:r})).then(e=>{this.consumerList=e.data,this.form.consumer_id=Object.keys(e.data)[0]}).catch(e=>{toastr.error("Error fetching account details."),console.error(e)})},fetchBanks(){v.get(route("api.bank.pluck")).then(r=>{this.form.bank_id=Object.keys(r.data)[0],this.banksOptions=r.data}).catch(r=>{toastr.error("Error fetching account details."),console.error(r)})},resetFilters(){this.filters.month="",this.filters.year="",this.filters.fromDate="",this.filters.toDate=""},handleSearch(){this.isLoading=!0,this.fetchDetails()},clearFields(){},fetchDetails(){const r={month:this.filterType==="monthYear"?this.filters.month:"",year:this.filterType!=="dateRange"?this.filters.year:"",fromDate:this.filterType==="dateRange"?this.filters.fromDate:"",toDate:this.filterType==="dateRange"?this.filters.toDate:""};v.get(route("api.fetch.account.details"),{params:r}).then(e=>{let m=0;this.Accounts=e.data.map(p=>{const o=p.cash_in||0,l=p.cash_out||0;return m+=o-l,{...p,cash_in:o,cash_out:l,balance:m}})}).catch(e=>{toastr.error("Error fetching account details.")}).finally(()=>{this.isLoading=!1})},formatDate(r){return new Date(r).toLocaleDateString()},formatNumber(r){return r==null?"-":r.toLocaleString()},convertToWords(r){return r==null?"No balance":r.toString()},downloadPDF(){this.pdfBtnSpinner=!0;const r=new N;r.setFontSize(18),r.setTextColor(40),r.text("Account Ledger Details",14,20);const e=this.Accounts.map((m,p)=>[p+1,m.consumer_name,m.process_type,m.note||"-",this.formatNumber(m.cash_in),this.formatNumber(m.cash_out),this.formatDate(m.date),m.ref_no||"-",this.formatNumber(m.balance)]);r.autoTable({startY:30,head:[["#","Consumer Name","Process Type","Notes","Cash In","Cash Out","Date","Ref.No","Balance"]],body:e,styles:{fontSize:10,halign:"center"},headStyles:{fillColor:[0,0,0],textColor:[255,255,255]}}),r.save("Account_Ledger.pdf"),this.pdfBtnSpinner=!1},submit(){this.formStatus=!1,v.post(route("api.account.data.store"),this.form).then(()=>{var r;this.formStatus=!0,toastr.success("Account record saved successfully."),(r=this.$refs.closeModal)==null||r.click()}).catch(r=>{this.formStatus=!0,this.formErrors=r.response.data.errors||{},toastr.error("There was an error saving the account record.")})}}},F={id:"main",class:"main"},L={class:"pagetitle d-flex justify-content-between"},x={class:"section"},U={class:"card"},B={class:"card-body"},w={class:"filters mb-3"},M={class:"row"},Y={class:"col-md-4"},I={key:0,class:"col-md-3"},P={key:0,class:"invalid-feedback animated fadeIn"},R={key:1,class:"col-md-3"},j={key:0,class:"invalid-feedback animated fadeIn"},W={key:2,class:"col-md-3"},z={key:0,class:"invalid-feedback animated fadeIn"},J={key:3,class:"col-md-3"},Z={key:0,class:"invalid-feedback animated fadeIn"},q={class:"col-md-2"},G=["disabled"],H={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},K={key:1},Q={class:"table-responsive"},X={class:"table table-striped"},$={scope:"row"},ee=["title"],oe=["title"],se=["title"],te={key:0,class:"d-flex justify-content-end mb-1"},re={key:1,class:"btn btn-success",type:"button",disabled:""},le={class:"modal fade",id:"bankmodal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ne={class:"modal-dialog modal-lg"},ae={class:"modal-content"},ie={class:"modal-header"},de={class:"modal-title text-primary"},me={class:"modal-body"},ce={class:"card card-body p-3"},ue={class:"row g-3"},fe={class:"col-md-6 col-12"},be={key:0,class:"invalid-feedback"},pe={class:"col-md-6 col-12"},he={for:"consumer_id",class:"form-label"},_e={key:0,class:"invalid-feedback"},ve={class:"col-md-6 col-12"},ye={key:0,class:"invalid-feedback"},ke={class:"col-md-6 col-12"},ge={key:0,class:"invalid-feedback"},De={class:"col-md-6 col-12"},Ee={key:0,class:"invalid-feedback"},Ve={class:"col-md-6 col-12"},Ce={key:0,class:"invalid-feedback"},Se={class:"col-md-6 col-12"},Te={key:0,class:"invalid-feedback"},Ae={class:"col-md-6 col-12"},Ne={key:0,class:"invalid-feedback"},Oe={class:"col-md-6 col-12"},Fe={key:0,class:"invalid-feedback"},Le={class:"mt-3"},xe=["disabled"],Ue={key:0,class:"spinner-border spinner-border-sm"},Be={hidden:"","data-bs-toggle":"modal","data-bs-target":"#customermodal",ref:"closeModal"};function we(r,e,m,p,o,l){const f=g("Multiselect"),y=g("Datepicker");return n(),a("main",F,[s("div",L,[e[22]||(e[22]=V('<div><h1 class="theme-text-color">Accounts</h1><nav><ol class="breadcrumb"><li class="breadcrumb-item"><a href="/dashboard">Alsmi</a></li><li class="breadcrumb-item">Accounts</li><li class="breadcrumb-item active">Index</li></ol></nav></div>',1)),s("div",null,[s("button",{class:"btn btn-success mt-3","data-bs-toggle":"modal","data-bs-target":"#bankmodal",onClick:e[0]||(e[0]=t=>{l.clearFields(),l.processFor("Cash In")})},e[20]||(e[20]=[s("i",{class:"bi bi-plus-lg"},null,-1),b(" Cash In ")])),s("button",{class:"btn btn-success mt-3 ms-1","data-bs-toggle":"modal","data-bs-target":"#bankmodal",onClick:e[1]||(e[1]=t=>{l.clearFields(),l.processFor("Cash Out")})},e[21]||(e[21]=[s("i",{class:"bi bi-dash-lg"},null,-1),b(" Cash Out ")]))])]),s("section",x,[s("div",U,[s("div",B,[e[33]||(e[33]=s("h5",{class:"card-title theme-text-color"},"Account Ledger",-1)),s("div",w,[s("div",M,[s("div",Y,[e[23]||(e[23]=s("label",{for:"filterType"},"Filter By",-1)),u(f,{modelValue:o.filterType,"onUpdate:modelValue":e[2]||(e[2]=t=>o.filterType=t),options:o.filterOptions,placeholder:"Select Filter Type",searchable:!0,onChange:l.resetFilters,class:c({"invalid-bg":o.formErrors.filterType})},null,8,["modelValue","options","onChange","class"])]),o.filterType==="monthYear"?(n(),a("div",I,[e[24]||(e[24]=s("label",{for:"month"},"Month",-1)),u(f,{modelValue:o.filters.month,"onUpdate:modelValue":[e[3]||(e[3]=t=>o.filters.month=t),l.fetchDetails],options:o.months,placeholder:"Select Month",searchable:!0},null,8,["modelValue","options","onUpdate:modelValue"]),o.formErrors.month?(n(),a("div",P,i(o.formErrors.month[0]),1)):d("",!0)])):d("",!0),o.filterType==="monthYear"||o.filterType==="yearOnly"?(n(),a("div",R,[e[25]||(e[25]=s("label",{for:"year"},"Year",-1)),u(f,{modelValue:o.filters.year,"onUpdate:modelValue":[e[4]||(e[4]=t=>o.filters.year=t),l.fetchDetails],options:o.years,placeholder:"Select Year",searchable:!0},null,8,["modelValue","options","onUpdate:modelValue"]),o.formErrors.year?(n(),a("div",j,i(o.formErrors.year[0]),1)):d("",!0)])):d("",!0),o.filterType==="dateRange"?(n(),a("div",W,[e[26]||(e[26]=s("label",{for:"fromDate"},"From Date",-1)),u(y,{autoApply:"",enableTimePicker:!1,id:"fromDate",modelValue:o.filters.fromDate,"onUpdate:modelValue":[e[5]||(e[5]=t=>o.filters.fromDate=t),l.fetchDetails]},null,8,["modelValue","onUpdate:modelValue"]),o.formErrors.fromDate?(n(),a("div",z,i(o.formErrors.fromDate[0]),1)):d("",!0)])):d("",!0),o.filterType==="dateRange"?(n(),a("div",J,[e[27]||(e[27]=s("label",{for:"toDate"},"To Date",-1)),u(y,{autoApply:"",enableTimePicker:!1,id:"toDate",modelValue:o.filters.toDate,"onUpdate:modelValue":[e[6]||(e[6]=t=>o.filters.toDate=t),l.fetchDetails]},null,8,["modelValue","onUpdate:modelValue"]),o.formErrors.toDate?(n(),a("div",Z,i(o.formErrors.toDate[0]),1)):d("",!0)])):d("",!0),s("div",q,[s("button",{class:"btn btn-success mt-4",onClick:e[7]||(e[7]=(...t)=>l.handleSearch&&l.handleSearch(...t)),disabled:o.isLoading},[o.isLoading?(n(),a("span",H)):(n(),a("span",K,"Search"))],8,G)])])]),e[34]||(e[34]=s("hr",null,null,-1)),s("div",Q,[s("table",X,[e[30]||(e[30]=s("thead",null,[s("tr",null,[s("th",{scope:"col"},"#"),s("th",{scope:"col"},"Consumer Name"),s("th",{scope:"col"},"Process Type"),s("th",{scope:"col"},"Notes"),s("th",{scope:"col"},"Cash In"),s("th",{scope:"col"},"Cash Out"),s("th",{scope:"col"},"Date"),s("th",{scope:"col"},"Ref.No"),s("th",{scope:"col"},"Balance")])],-1)),s("tbody",null,[(n(!0),a(C,null,S(o.Accounts,(t,k)=>(n(),a("tr",{key:k},[s("th",$,i(k+1),1),s("td",null,[b(i(t.consumer_name)+" ",1),e[29]||(e[29]=s("br",null,null,-1)),s("small",null,[b(i(t.bank_title)+" ",1),e[28]||(e[28]=s("br",null,null,-1)),b(" "+i(t.bank_account),1)])]),s("td",null,i(t.process_type),1),s("td",null,i(t.note),1),s("td",{title:l.convertToWords(t.cash_in||0)},i(l.formatNumber(t.cash_in||0)),9,ee),s("td",{title:l.convertToWords(t.cash_out||0)},i(l.formatNumber(t.cash_out||0)),9,oe),s("td",null,i(l.formatDate(t.date)),1),s("td",null,i(t.ref_no||"-"),1),s("td",{title:l.convertToWords(t.balance)},i(l.formatNumber(t.balance)),9,se)]))),128))])]),o.Accounts&&o.Accounts.length>0?(n(),a("div",te,[o.pdfBtnSpinner?(n(),a("button",re,e[32]||(e[32]=[s("span",{class:"spinner-border spinner-border-sm"},null,-1)]))):(n(),a("button",{key:0,onClick:e[8]||(e[8]=(...t)=>l.downloadPDF&&l.downloadPDF(...t)),class:"btn btn-success mt-3 ml-3"},e[31]||(e[31]=[s("i",{class:"bi bi-file-earmark-pdf"},null,-1),b(" Download PDF ")])))])):d("",!0)])])])]),s("div",le,[s("div",ne,[s("div",ae,[s("div",ie,[s("h5",de,i(o.form.process_for),1),e[35]||(e[35]=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),s("div",me,[s("div",ce,[s("div",ue,[s("div",fe,[e[36]||(e[36]=s("label",{for:"consumer",class:"form-label"},"Choose Type",-1)),u(f,{modelValue:o.form.consumer,"onUpdate:modelValue":e[9]||(e[9]=t=>o.form.consumer=t),options:o.consumerOptions,placeholder:"Process choose type",searchable:!0,onSelect:e[10]||(e[10]=t=>l.fetchConsumersList(o.form.consumer)),class:c({"invalid-bg":o.formErrors.consumer})},null,8,["modelValue","options","class"]),o.formErrors.consumer?(n(),a("div",be,i(o.formErrors.consumer[0]),1)):d("",!0)]),s("div",pe,[s("label",he,"Available "+i(o.form.consumer)+"'s List",1),u(f,{modelValue:o.form.consumer_id,"onUpdate:modelValue":e[11]||(e[11]=t=>o.form.consumer_id=t),options:o.consumerList,placeholder:"Select name",searchable:!0,class:c({"invalid-bg":o.formErrors.consumer_id})},null,8,["modelValue","options","class"]),o.formErrors.consumer_id?(n(),a("div",_e,i(o.formErrors.consumer_id[0]),1)):d("",!0)]),s("div",ve,[e[37]||(e[37]=s("label",{for:"bank_id",class:"form-label"},"Bank",-1)),u(f,{modelValue:o.form.bank_id,"onUpdate:modelValue":e[12]||(e[12]=t=>o.form.bank_id=t),options:o.banksOptions,placeholder:"Select Bank",searchable:!0,class:c({"invalid-bg":o.formErrors.bank_id})},null,8,["modelValue","options","class"]),o.formErrors.bank_id?(n(),a("div",ye,i(o.formErrors.bank_id[0]),1)):d("",!0)]),s("div",ke,[e[38]||(e[38]=s("label",{for:"transaction_type",class:"form-label"},"Transaction type",-1)),u(f,{modelValue:o.form.transaction_type,"onUpdate:modelValue":e[13]||(e[13]=t=>o.form.transaction_type=t),options:o.transaction_typeOptions,placeholder:"Select Bank",searchable:!0,class:c({"invalid-bg":o.formErrors.transaction_type})},null,8,["modelValue","options","class"]),o.formErrors.transaction_type?(n(),a("div",ge,i(o.formErrors.transaction_type[0]),1)):d("",!0)]),s("div",De,[e[39]||(e[39]=s("label",{for:"amount",class:"form-label"},"amount",-1)),h(s("input",{type:"number",class:c(["form-control",{"invalid-bg":o.formErrors.amount}]),id:"amount","onUpdate:modelValue":e[14]||(e[14]=t=>o.form.amount=t)},null,2),[[_,o.form.amount]]),o.formErrors.amount?(n(),a("div",Ee,i(o.formErrors.amount[0]),1)):d("",!0)]),s("div",Ve,[e[40]||(e[40]=s("label",{for:"ref_no",class:"form-label"},"Ref.No",-1)),h(s("input",{type:"text",class:c(["form-control",{"invalid-bg":o.formErrors.ref_no}]),id:"ref_no","onUpdate:modelValue":e[15]||(e[15]=t=>o.form.ref_no=t)},null,2),[[_,o.form.ref_no]]),o.formErrors.ref_no?(n(),a("div",Ce,i(o.formErrors.ref_no[0]),1)):d("",!0)]),s("div",Se,[e[41]||(e[41]=s("label",{for:"account",class:"form-label"},"Account #",-1)),h(s("input",{type:"text",class:c(["form-control",{"invalid-bg":o.formErrors.account}]),id:"account","onUpdate:modelValue":e[16]||(e[16]=t=>o.form.account=t)},null,2),[[_,o.form.account]]),o.formErrors.account?(n(),a("div",Te,i(o.formErrors.account[0]),1)):d("",!0)]),s("div",Ae,[e[42]||(e[42]=s("label",{for:"current_amount",class:"form-label"},"Current Amount",-1)),h(s("input",{type:"number",class:c(["form-control",{"invalid-bg":o.formErrors.current_amount}]),id:"current_amount","onUpdate:modelValue":e[17]||(e[17]=t=>o.form.current_amount=t)},null,2),[[_,o.form.current_amount]]),o.formErrors.current_amount?(n(),a("div",Ne,i(o.formErrors.current_amount[0]),1)):d("",!0)]),s("div",Oe,[e[43]||(e[43]=s("label",{for:"date",class:"form-label"},"Date",-1)),h(s("input",{type:"date",class:c(["form-control",{"invalid-bg":o.formErrors.date}]),id:"date","onUpdate:modelValue":e[18]||(e[18]=t=>o.form.date=t)},null,2),[[_,o.form.date]]),o.formErrors.date?(n(),a("div",Fe,i(o.formErrors.date[0]),1)):d("",!0)]),s("div",Le,[s("button",{disabled:!o.formStatus,class:"btn btn-success",onClick:e[19]||(e[19]=(...t)=>l.submit&&l.submit(...t))},[e[44]||(e[44]=b(" Save ")),o.formStatus?d("",!0):(n(),a("span",Ue))],8,xe)])])])])])]),s("button",Be,null,512)])])}const ze=E(O,[["render",we]]);export{ze as default};
